---
title: Working on it
date: 2022-06-25 00:00:00 +0800
categories: [notes]
tags: [notes]
---

分 2 部分介绍：

* 「日常需求」的完整工作流程
* 「线上服务」的运维

## 一. 流程

前提：

* 效率相关
* 故障相关
  * 定义什么是故障
  * 定义故障等级（受影响用户数 + 时长）
  * 设定目标

------

工作流程包括以下环节：

* 技术评审
* 变更管理：
  * 代码分支管理
  * 代码提交卡点：代码规范检测，安全审核，中间件版本检测，CR，单测通过。。。
  * 数据库（或中间件）变更规范
  * 系统变更管理
* 推进：开发环境 -> 联调环境 -> 测试环境 -> 预发环境
* 测试：自测        ->  联调        -> QA 测试   -> QA 验证通过 -> 是否压测？
* 发布：灰度 -> 引流 -> 分批发布
* 回滚

### 1. 技术评审

* 需求的开发负责人组织评审工作
* 形式可以多样，但涉及的相关人员都要确认（特别是 QA 人员的确认）
* 基于「技术评审」的结果确认所有工作的时间表（特别是 QA 人员的测试时间表）

### 2. 变更管理

* 代码分支管理：主干开发模式 vs. 迭代分支模式
* 代码规范 & 安全审核 & 中间件版本检测 & 单测通过
* CR 卡点时机？
* 数据库变更规范 & 中间件变更规范
* 数据库/中间件/系统变更的回滚方案

### 3. 环境 & 效率

* 建设稳定的开发/测试环境的目标是效率
  * 自测环境 -> 开发效率
  * 联调环境 -> 联调效率
  * 测试环境 -> QA 测试效率

### 4. 测试流程

* 提测时间点
* 在哪个环境提测的讨论：
  * 「测试环境」vs.「预发环境」（需要同时测试多个需求？）
* QA 人员发布「测试报告」
  * 是否压测在「技术评审」时确定

### 5. 发布

* 「发布」和「运维」相互关联
  * 「红线」
* 「发布方案」也是「技术评审」的一部分
* 依据「效率」&「故障」指标来制定对应的「发布流程规范」
  * 设置各个发布阶段的卡点策略（灰度 -> 引流 -> 分批发布）
  * 需要相关「运维」工具的支持
    * 日志/监控/报警
    * 限流/降级
* 回滚流程（应急手册 + 事先演练）

### 6. 中间件的迭代

* 监控和统计
  * 版本分布/接口分布（日志和统计接口）
* CR 策略
* 测试策略
  * 回归测试/压力测试（自动化测试用例集合）
* 发布策略

## 二. 运维

### 1. 运维粒度

* 业务级别 / 服务级别 / 应用级别。。。
* 系统级别 / 单机级别 / 容器级别。。。

### 2. 运维指标

各个「运维粒度」对应的运维指标：

* 业务级别：业务指标
* 服务级别：QPS/耗时/失败率
* 应用级别：CPU / 负载 / 内存 / 错误数。。。
* 系统级别：上下游错误数
* 单机 / 容器级别：CPU / 负载 / 内存 / 错误数。。。

但最重要的核心指标还是围绕服务级别：QPS/耗时/失败率

### 3. 链路梳理

* 强弱依赖/系统瓶颈/系统容量 -> 压测 -> 风险评估
  * 配合具体业务目标进行梳理
* 压测相关
  * 压测的风险：也是也是故障的普遍来源之一
  * 压测流量的区分
  * 压测策略的选择（单机/接口级/应用级/单链路级/全链路级别）

### 4. 报警监控应急

监控 -> 报警 -> 应急手册

依赖各种运维工具：

* 监控相关
  * 业务指标跟踪
  * 链路跟踪 + Metric（基于中间件日志）
  * 中间件日志/应用日志错误实时分析
  * 系统指标监控（CPU，内存，负载，网络，JVM。。。）
* 报警相关
  * 依据「故障」指标来对报警进行设置
  * 核心指标：出现故障到相关人员上线处理的时长
* 应急相关（基于之前的「链路梳理」，「监控」，「报警」）
  * 预案可能需要包括以下方面：
    * 人员 & 沟通
    * 限流
    * 降级
    * 回滚
  * 应急演练（例如进行压测的同时，对各种预案进行演练）
