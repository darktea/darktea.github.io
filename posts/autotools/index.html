<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Autotools 使用入门" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="序. Intro" /><meta property="og:description" content="序. Intro" /><link rel="canonical" href="https://darktea.github.io/posts/autotools/" /><meta property="og:url" content="https://darktea.github.io/posts/autotools/" /><meta property="og:site_name" content="Darktea" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2012-06-24T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Autotools 使用入门" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-22T17:21:48+08:00","datePublished":"2012-06-24T00:00:00+08:00","description":"序. Intro","headline":"Autotools 使用入门","mainEntityOfPage":{"@type":"WebPage","@id":"https://darktea.github.io/posts/autotools/"},"url":"https://darktea.github.io/posts/autotools/"}</script><title>Autotools 使用入门 | Darktea</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Darktea"><meta name="application-name" content="Darktea"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/favicons/android-chrome-512x512.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Darktea</a></div><div class="site-subtitle font-italic">Know nothing</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/darktea" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['tiantianding','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> 首页 </a> </span> <span>Autotools 使用入门</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 文章</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..."> </span> <span id="search-cancel" >取消</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Autotools 使用入门</h1><div class="post-meta text-muted"><div> 作者 <em> <a href="https://github.com/darktea">darktea</a> </em></div><div class="d-flex"><div> <span> 发表于 <em class="timeago" data-ts="1340467200" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2012-06-24 </em> </span> <span> 更新于 <em class="timeago" data-ts="1666430508" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-10-22 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3156 字"> <em>17 分钟</em>阅读</span></div></div></div><div class="post-content"><h2 id="序-intro"><span class="mr-2">序. Intro</span><a href="#序-intro" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>介绍 Autotools 的相关文章网上已经太多了，但这些文章要么是把一大堆工具列举出来，要么就是来一个 step by step 的例子。</p><p>但 Autotools 这套工具本身比较杂乱，罗列一堆工具，看了以后多半没有什么印象。</p><p>而 step by step 的例子做完一遍之后，也多半不知其所以然。</p><p>最好的入门材料还是 Autoconf 和 Automake 的官方文档：</p><ul><li><a href="http://www.gnu.org/software/autoconf/">http://www.gnu.org/software/autoconf/</a><li><a href="http://www.gnu.org/software/automake/">http://www.gnu.org/software/automake/</a></ul><p>可惜看初学者一上来就要面对几百页的英文文档，又有点下不了手。</p><p>本文的目的就是使得初学者可以快速入门，马上能在自己的项目中使用 Autotools 工具。</p><p>然后可以在以后的使用过程中，通过查询官方文档来解决实际遇到的问题，在实践中深入全面掌握其高阶用法。</p><p>这个入门分两部分，</p><p>第一部分介绍基础概念；</p><p>第二部分展现了一个完整的例子，可以参照这个例子把已有项目改成用 Autotools 工具来 build。</p><p>GNU Autotools 一般指的是3个 GNU 工具包：Autoconf，Automake 和 Libtool (本文先介绍前两个工具，Libtool留到今后介绍)</p><p>它们能解决什么问题，要先从 GNU 开源软件的 Build 系统说起。一般来说。GNU 软件的安装过程都是：</p><ol><li>解压源代码包<li>./configure<li>make<li>make install</ol><p>这个过程中， 需要有一个 configure 脚本，同时也需要一个 Makefile 文件。</p><p>而 Autoconf 和 Automake 就是一套自动生成 configure 脚本和 Makefile 文件的工具。</p><h2 id="一-autoconf-解决什么问题"><span class="mr-2">一. Autoconf 解决什么问题</span><a href="#一-autoconf-解决什么问题" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>最早的时候，程序员完成源代码开发以后，发布代码包时，一般会附带相应的 Makefile 文件。然后就可以 make &amp;&amp; make install 来编译工程。当时并不需要这个运行 configure 的步骤。</p><p>但是如果一个程序被广泛使用以后 (特别是成功的开源软件)，可能需要被安装到不同的平台上使用。这个时候，在不同的平台做 build 的时，一方面可能需要对 Makefile 文件进行调整 (最常见的例子就是：编译器的名字在不同的平台可能不同)。另外一方面，可能需要用一个替代函数来替换当前平台所不支持的函数 (例如：有的平台上不支持strdup这个调用)，需要在程序里面给每个平台写#define。</p><p>为了避免手工做这些调整，人们开始写 configure 脚本来自动做这些调整工作 (现在在 make 之前先运行 configure 是 GNU Code Style 标准所规定的)。</p><p>configure 脚本一般会先检查目前的环境，然后生成一个config.h 文件 (里面带了各种各样的#define) ，同时会生成一个 针对当前平台的 Makefile 文件，之后，make 命令就会使用到这个 Makefile文件。</p><p>另外，GNU的 build 系统还有一些”乱七八糟”的功能，用户在使用 configure 这个脚本的时候，可能会使用到这些功能 (最常见的就是用 –prefix 来指定安装路径，用configure –help来查看说明等等)。</p><p>但是，过了一段时间以后，人们发现靠人手工写这个 configure 脚本工作量太巨大了，而且以后维护这个 configure也比较麻烦：一旦发现项目在某个平台的移植性有问题，就需要更新这个 configure 脚本，比较繁琐。于是，人们就开发了 Autoconf 这个工具集来自动生成 configure 脚本。</p><p>总之，相对于手工维护 configure 脚本，用 Autoconf 工具来生成 configure 有以下好处：</p><ol><li>不需要手工写configure来支持 GNU Build System 规定的一些必须的功能。例如：在运行configure的时候对目录参数进行设置 (最常见的就是 –prefix=…)。或者可以设置 build 选项, 例如, 设置 CFLAGS 什么的<li>用 Autoconf 自动生成的 configure 能完美的支持各种不同的平台上 (手工写几乎是不可能的)。当 GNU Coding Style 更新的时候, Autoconf 会统一做相应的更新, 不需要所有的项目都自己去手工调整 configure 脚本。</ol><h2 id="二-automake-解决什么问题"><span class="mr-2">二. Automake 解决什么问题</span><a href="#二-automake-解决什么问题" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>上面介绍了 Autoconf 的功能，接下来介绍 Automake。</p><p>有了 Autoconf 工具以后，人们能自动生成 configure 脚本，configure 脚本一般会做以下工作：</p><ol><li>检查用户的环境是否满足 GNU 程序的 Build 环境 (Autoconf 提供了很多macro来做各种各样的检查)<li>替换模版文件，生成最后 Build 工程所需要的 Makefile，config.h 等文件 (其中 Makefile 的模版文件是 Makefile.in, 而 config.h 的模版文件是 config.h.in)</ol><p>这里要特别说明的是 configure 是通过替换模版文件中的一些平台相关变量和 Build 选项来生成最后的 Makefile 文件 (和当前平台相关的 Makefile 文件)。</p><p>虽然 configure 文件是 Autoconf 自动生成的，但是模版文件 Makefile.in 还是要程序员自己写。下面是一个简单的 Makefile.in 的片段 (基本上就是普通 Makefile 文件的样子，除了 configure 脚本会替换掉那些用@包含的变量)：</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c"># Package-specific substitution variables</span>
package  <span class="o">=</span> @PACKAGE_NAME@
version  <span class="o">=</span> @PACKAGE_VERSION@
tarname  <span class="o">=</span> @PACKAGE_TARNAME@
distdir  <span class="o">=</span> <span class="si">$(</span>tarname<span class="si">)</span>-<span class="si">$(</span>version<span class="si">)</span>

<span class="c"># Prefix-specific substitution variables</span>
prefix  <span class="o">=</span> @prefix@
exec_prefix <span class="o">=</span> @exec_prefix@
bindir  <span class="o">=</span> @bindir@

<span class="c"># Tool-specific substitution variables</span>
CFLAGS  ?<span class="o">=</span> <span class="nt">-g</span> <span class="nt">-O2</span>

<span class="c"># VPATH-specific substitution variables</span>
srcdir  <span class="o">=</span> @srcdir@
VPATH  <span class="o">=</span> @srcdir@

all: jupiter

hello: main.c
    <span class="si">$(</span>CC<span class="si">)</span> <span class="si">$(</span>CFLAGS<span class="si">)</span> <span class="si">$(</span>CPPFLAGS<span class="si">)</span> <span class="nt">-I</span><span class="nb">.</span> <span class="nt">-I</span><span class="si">$(</span>srcdir<span class="si">)</span> <span class="nt">-I</span>.. <span class="nt">-o</span> <span class="nv">$@</span> <span class="si">$(</span>srcdir<span class="si">)</span>/main.c

</pre></table></code></div></div><p>而写这个 Makefile.in 估计每个程序员都会一开始自己写一个，之后做其他项目的时候，就在已有 Makefile.in 的基础上改一下直接用了。</p><p>这种做法有一些弊端，一方面都是手工操作，自动化不够；另外一方面在 copy 修改过程中可能会出现一些问题。</p><p>而 Automake 的目的就是可以帮助程序员自动生成模版文件 Makefile.in。而程序员只需要提供一个简单的 Makefile.am 文件来描述依赖关系就行了。</p><p>例如, 只要在 Makefile.am 中写两行：</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c"># 目标</span>
bin_PROGRAMS <span class="o">=</span> hello
<span class="c"># 所依赖的源文件</span>
hello_SOURCES <span class="o">=</span> main.c
</pre></table></code></div></div><p>然后 Automake 就可以根据 Makefile.am 的描述自动生成 Makefile.in 模版文件。</p><h2 id="三-例子"><span class="mr-2">三. 例子</span><a href="#三-例子" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>提供一个简单利用 Autotools 来 build 项目的例子。这个例子重点展示的是怎么把一个目录结构有点怪的已有项目改成用 Autotools 工具来 build 系统。</p><p>先说明一下，本文所使用的各个工具的版本 (因为 Autotools 工具集经常更新，老的版本可能和新版本有细微的差异)</p><ul><li>autoconf 2.67 版<li>automake 1.11.1 版</ul><p>然后介绍一下项目 (假设项目名称为 earth) 的目录结构：</p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>           earth
      /               \
   src              test
   /                      \
fun.h fun.c          funtest
                                \
                             funtest1.c funtest2.c

</pre></table></code></div></div><p>项目根目录下有两个子目录 src 和 test。其中 src 目录放源代码，而 test 目录下面放测试代码；而测试代码又被分成很多组，每组是一个测试目录。</p><p>例如, test 目录下的 funtest 目录是一个测试组 (这个例子中只有一组测试)，用来对 fun.h/fun.c 进行测试，其中包含了两个测试用例，两个测试程序都可以链接出可执行文件 (funtest1.c 包含了一个 main 函数，funtest2.c 也包含了一个 main 函数)。</p><p>使用 Autotools 就是要利用 Autoconf 来生成 configure 脚本，同时利用 Automake 来生成 Makefile.in 和 config.h (因为这个例子程序比较简单, 没有用到什么特殊的调用, config.h 中也没有什么特殊的定义)</p><p>所以首先要提供这两个工具所需的输入文件：</p><ol><li>configure.ac：Autoconf 所需 (就是一组宏定义，Autoconf 使用这些宏进行平台相关的检查, 并生成 configure 脚本)<li>Makefile.am： Automake 所需 (特别注意，Automake 不单独使用，会和 Autoconf 配合使用。因此 configure.ac 里面也有 Automake 相关的宏定义)</ol><h3 id="1-configureac"><span class="mr-2">1. configure.ac</span><a href="#1-configureac" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>一般来说，尽量直接使用 Autoconf 工具提供的 macro 来做各种各样的检查，最好不要自己写 macro 来做这些检查。因为Autoconf 提供的这些 macro 已经经过千锤百炼，适用不同的平台不同的系统，自己写多半不能做到像它这样全面。</p><p>earth 项目的 configure.ac：</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>AC_INIT<span class="o">([</span>earth], <span class="o">[</span>1.0], <span class="o">[</span>bug-report@earth.com]<span class="o">)</span>
AM_INIT_AUTOMAKE<span class="o">([</span>foreign <span class="nt">-Werror</span><span class="o">])</span>

AC_PROG_CC

AC_CONFIG_SRCDIR<span class="o">([</span><span class="nb">test</span>/funtest/funtest1.c]<span class="o">)</span>
AC_CONFIG_HEADERS<span class="o">([</span>config.h]<span class="o">)</span>
AC_CONFIG_FILES<span class="o">([</span>Makefile <span class="nb">test</span>/Makefile <span class="nb">test</span>/funtest/Makefile]<span class="o">)</span>

AC_OUTPUT
</pre></table></code></div></div><p>这里只特别说明一下 AC_CONFIG_FILES 这个宏的作用 (其他宏是必须的, 但是含义比较简单, 先直接照葫芦画瓢就行了, 具体细节可以查询 Autoconf 的手册)</p><p>AC_CONFIG_FILES 指明了需要根据模版生成的 Makefile 文件. 在这个例子中, 需要生成 3 个 Makefile 文件, 每个 Mafile 文件都需要一个模版:</p><ul><li>根目录下需要有模版文件 Makefile.in<li>test 目录下需要有模版文件 Makefile.in<li>test/funtest 目录下需要有模版文件 Makefile.in</ul><p>而这3个 Makefile.in 需要用 Automake 通过各自的 Makefile.am 来生成。</p><p>特别注意，这个例子比较特殊，不需要在 src 目录下面进行 build， 因为这个例子只需要在测试用例目录下面生成测试程序的可执行文件即可。</p><h3 id="2-makefileam"><span class="mr-2">2. Makefile.am</span><a href="#2-makefileam" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>在介绍如何编写 Makefile.am 之前，先说明一下 earth 项目为什么需要 3 个 Makefile 文件。</p><p>一般来说，都是在项目根目录下面运行 make &amp;&amp; make install 的。而具体到 earth 这个项目，希望运行 make 以后，会在 test/funtest 下生成测试程序，因此需要make递归运行： 先在根目录运行make，再在 test 目录下运行 make，最后才在test/funtest 下运行 make，生成两个测试程序的可执行文件。</p><p>可以通过配置 Makefile.am 来控制这个递归过程。其中：</p><p>根目录下的 Makefile.am (SUBDIRS 指明需要在哪些子目录递归生成模版文件 Makefile.in) 只需要一行：</p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>SUBDIRS=test
</pre></table></code></div></div><p>test目录下的 Makefile.am 只需要一行，指明在子目录 funtest 下执行 make：</p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>SUBDIRS =  funtest
</pre></table></code></div></div><p>test/funtest 目录下的 Makefile.am（test/funtest 目录下不需要再往下递归，所以不用设置SUBDIRS）。</p><p>由于需要描述出依赖关系，这个 Makefile.am 会比较复杂一点，有5行：</p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>bin_PROGRAMS = funtest1 funtest2

funtest1_SOURCES = funtest1.c ../../src/fun.h ../../src/fun.c
funtest1_CPPFLAGS = -I$(top_srcdir)/src

funtest2_SOURCES = funtest2.c ../../src/fun.h ../../src/fun.c
funtest2_CPPFLAGS = -I$(top_srcdir)/src
</pre></table></code></div></div><p>其中：</p><ul><li>bin_PROGRAMS 指明要生成那些可执行文件<li>funtest1_SOURCES 指明 funtest1 所依赖的源文件 (特别注意, 利用相对路径指明了所依赖的src目录下的源文件)<li>funtest1_CPPFLAGS = -I$(top_srcdir)/src 指明了编译时需要指定的头文件路径</ul><h3 id="3-利用-autotools-生成configure脚本和makefilein模版"><span class="mr-2">3. 利用 Autotools 生成configure脚本和Makefile.in模版</span><a href="#3-利用-autotools-生成configure脚本和makefilein模版" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>在configure.ac 和 Makefile.am 做好以后。在项目根目录运行：</p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>autoreconf --install
</pre></table></code></div></div><p>就可以生成 configure 脚本和所有的模版文件 Makefile.in</p><p>然后再运行</p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./configure &amp;&amp; make
</pre></table></code></div></div><p>就可以得到测试程序的可执行文件。</p><p>这里特别说明的是，Autoconf 和 Automake 是两个工具包。其中包含了多个工具软件，而这些工具软件要互相配合才能工作。</p><p>而这些工具软件间的关系比较复杂，单独运行各个工具软件也可以得到最后的 configure 脚本和模版文件 Makefile.in。</p><p>不过使用 autoreconf 这个命令可以自动安排各个工具软件的执行顺，所以一般推荐直接运行 autoreconf，而不是单独运行各个单独的工具软件。</p><h2 id="参考文档"><span class="mr-2">参考文档</span><a href="#参考文档" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><ul><li><a href="http://www.gnu.org/software/autoconf">autoconf 官方手册</a><li><a href="http://www.gnu.org/software/automake">automake 官方手册</a><li><a href="http://www.lrde.epita.fr/~adl/autotools.html">比较流行的一个入门文档</a> (这个人做过一段时间的维护工作)<li>最新的一本关于 Autotools 的书: Autotools: A Practioner’s Guide to GNU Autoconf, Automake, and Libtool</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%E5%B7%A5%E5%85%B7/'>工具</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/autotools/" class="post-tag no-text-decoration" >autotools</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 本文由作者按照 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 进行授权</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Autotools 使用入门 - Darktea&amp;url=https://darktea.github.io/posts/autotools/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Autotools 使用入门 - Darktea&amp;u=https://darktea.github.io/posts/autotools/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://darktea.github.io/posts/autotools/&amp;text=Autotools 使用入门 - Darktea" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="分享链接" data-title-succeed="链接已复制！"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">最近更新</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/rust-notes/">Rust Notes</a><li><a href="/posts/build-system/">Build Systems</a><li><a href="/posts/On-Designing-and-Deploying-Internet-Scale-Services/">On Designing and Deploying Internet-Scale Services</a><li><a href="/posts/URL-Encoding/">URL Encoding</a><li><a href="/posts/memory-manager/">Linux 内存管理</a></ul></div><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/notes/">notes</a> <a class="post-tag" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a> <a class="post-tag" href="/tags/2pc/">2pc</a> <a class="post-tag" href="/tags/autotools/">autotools</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/bazel/">bazel</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/c/">c</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">文章内容</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>相关文章</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/build-system/"><div class="card-body"> <em class="timeago small" data-ts="1651766400" > 2022-05-06 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Build Systems</h3><div class="text-muted small"><p> 一. CMake 1. Modern CMake Modern CMake: 围绕着 targets 来管理应用的构建。同时，要成功构建 target，也需要配置 target 对应的 properties。 Target：target 就是被构建应用的各个组件的抽象。一个可执行文件是一个 target，一个库是一个 target 构建一个应用就是构建一系列...</p></div></div></a></div><div class="card"> <a href="/posts/git-notes/"><div class="card-body"> <em class="timeago small" data-ts="1370534400" > 2013-06-07 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Git Notes</h3><div class="text-muted small"><p> 1. 新建远端 Git 仓库 先取好库的名字 (例如: myfirstrepo), 然后在 GitHub 等 Git 服务上建立新的 repository （参考具体服务帮助） 在 GitHub 上新建好库以后, 在本地新建目录 myfirstrepo. 然后执行 git init 然后 新建 README.md AUTHORS 文件. 提交到本地库的 master 分支上面...</p></div></div></a></div><div class="card"> <a href="/posts/right/"><div class="card-body"> <em class="timeago small" data-ts="1679587200" > 2023-03-24 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>右值引用</h3><div class="text-muted small"><p> 按 C++ 标准的发展来梳理出右值引用的概念。但会先复习一下引用的概念。 引用 先复习一下 C++ 中引用的概念： A reference defines an alternative name for an object 引用就是另外一个已经存在的对象的名字的别名 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled" prompt="上一篇"><p>-</p></span> <a href="/posts/swap-space/" class="btn btn-outline-primary" prompt="下一篇"><p>系统性能监控之 Swap Space</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/darktea">darktea</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。">保留部分权利。</span></p></div><div class="footer-right"><p class="mb-0"> 本站由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，采用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> 主题。</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/notes/">notes</a> <a class="post-tag" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a> <a class="post-tag" href="/tags/2pc/">2pc</a> <a class="post-tag" href="/tags/autotools/">autotools</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/bazel/">bazel</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/c/">c</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.min.js"></script> <script> $(function() { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches ) ) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Markdown converts to HTML */ $("pre").has("code.language-mermaid").each(function() { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<div class=\"mermaid\">${svgCode}</div>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); }); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">搜索结果为空</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/zh.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
